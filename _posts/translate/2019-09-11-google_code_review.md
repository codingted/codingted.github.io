---
title: 谷歌工程实践-CodeReview
category: translate
tags:  codereview
---

## 代码审核的标准

代码审核是为了保证代码的质量,保持良好的结构和一致的风格,不因为时间的推移而变得难以维护.

* 摒弃不需要的功能,即使该功能设计良好
* 没有最好的代码,只有不断改进的代码,所以不应该追求完美,而应该追求持续的改进,权衡是否接受CL
* Review应该保持开放的态度进行回复,可以轻松的指出有些东西可以更好或者一些补充的回复
* 代码的指导(包括代码质量,代码的规范,关于软件的设计思想)
* 不断改善代码库

### 原则

* 事实大于个人偏好
* 代码风格请遵循作者的指导
* 软件设计的各个方面几乎从来不是纯粹的风格问题，也不只是个人偏好。它们是建立在基本原则的基础上的，应该在这些原则的基础上加以衡量，而不仅仅是个人意见。有时有一些有效的选择。如果作者能够证明(通过数据或基于可靠的工程原理)几种方法是同样有效的，那么审稿人应该接受作者的偏好。否则，选择取决于软件设计的标准原则.
* 如果没有其他规则适用，那么审查员可能会要求作者与当前代码库中的内容保持一致，只要这不会恶化系统的整体代码健康状况.

### 解决分歧

双方基于现有的系统文档和第三方文档如:[CL作者代码评审指南](https://google.github.io/eng-practices/review/developer/)和[代码评审指南](https://google.github.io/eng-practices/review/reviewer/).如果还不能解决就需要面对面的讨论交流,团队会议...

<!-- more -->

## Code Review评审的是什么内容

* 代码设计得很好.
* 该功能对代码的用户很好
* 任何UI更改都是合理的，看起来也不错.
* 任何并行编程都是安全的.
* 代码并不比它需要的复杂.
* 开发人员没有实现他们将来可能需要但不知道现在需要的东西.
* 代码有适当的单元测试.
* 测试是精心设计的.
* 开发人员对所有东西都使用了清晰的名称.
* 注释清晰有用，主要解释为什么而不是什么.
* 代码被适当地文档化(通常在g3doc中).
* 代码符合我们的样式指南.

## 检查CL

### 第一步:更广的视角看待变化

检查变更是否必要,如果变更不必要要马上回复,并解释为什么不需要变化,并且提出自己针对该变化的建议(保持态度亲和).

### 第二步:检查CL变化的主要逻辑

定位CL描述的主要的变化逻辑,如果CL涉及的逻辑比较多,需要询问开发人员主要逻辑,或者请求将本次提交进行[拆分](https://google.github.io/eng-practices/review/developer/small-cls.html).

如果发现主要设计或主要逻辑的错误,需要尽快通知开发者,对于未review的部分可以略过,因为如果是设计出现错误或者主要逻辑错误,那很可能意味着其它部分的修改也需要相应的调整,所以对这部分代码的review很可能是无意义的.

### 第三步:以适当的顺序review剩下的代码

## 加速review

review不及时带来的问题:

* 整个团队的速度降低
* 开发人员对code review处理进度的抱怨
* 代码整体的质量降低(堆积的大量的review处理的不够慎重)

### Code Review 速度

* 如果不是在紧急的任务中需要对新的Review进行简单的处理
* 最长不超过一个工作日

当然在保证自己的工作不被搅乱的情况下有序的处理Review,选择合理的时机:编码工作告一段落、饭后、会议结束后...

如果当前不能review可以告知开发者什么时间可以开始review,避免心理等待时间过长.如果最近确实没有时间可以建议其他人进行review.

**注意**:不要为了加速Review而降低[review的标准](https://google.github.io/eng-practices/review/reviewer/standard.html).

## 如何撰写code review的评论

* 和气
* 阐述你的原因
* 指出问题,避免明确的指示,应该由开发者决定如何处理问题
* 建议开发人员使用简明清晰的代码和注释替代对复杂实现的解释

## 处理对Code Review结论的质疑

面对Code Review的驳回有时候会有得不到开发人员的认同,这时候该怎么办?

### 谁是正确的

面对质疑首先要想到,是不是他们(开发者)是正确的?因为开发者更了解他们的代码,如果是这样就撤销问题.

如果认为review没有问题需要耐心的听取开发人员的意见,并予以解释,必要的情况下需要准备恰当的示例.

重要的是双方要互相的倾听,认真的思考对方的理由.

不接受"稍后修改",因为"稍后修改"可能被别的工作打扰,然后被遗忘.

## 引用

[eng-practices](https://google.github.io/eng-practices)
